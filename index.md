# 一、基本概念

## 1. 总体概述

### C\C++ 的跨平台原理

.c/cpp 文件会被编译成不同的文件（可执行文件），以便在不同平台上运行。 比如 window 编译成 PE 格式文件。 Mac => Mach-o 、 Linux => ELF。

### java 的跨平台原理

.java =>编译后 => .class(字节码) => 运行在平台上的 JVM（JAVA 虚拟机） => 再编译成机器指令 => 在操作系统运行

### js 的跨平台原理

js => 浏览器（各平台浏览器） => 编译成机器指令 => 操作系统运行

### 网络模型

OSI 模型：国际标准化组织 ISO 在 1985 年制定，偏理论，有点偏离实际。
TCP/IP 协议：实际开发人员认可的协议模型。
学习研究：将 TCP/IP 层的网络接口层，分为和 OSI 模型一样，分为数据链路层和物理层。主要是为了做研究。

## 2.计算机中的通信基础

1. 需要得知对方的 IP 地址。IP 地址最终会被解析处理为 MAC 地址。

2. 最终是根据 MAC 地址（网卡地址），输送数据到网卡，被网卡接收。

3. 如果网卡发现数据的目标 MAC 地址是自己，就会将数据传递给上一层进行处理。

4. 数据包里包含：源 IP、目标 IP、源 MAC、目标 MAC

## 计算机之间的连接方式

### 1. 网线直连

需要使用交叉线（不是直通线）。连接后在一个局域网下便可以直接通信。
ping 走的是 ICMP 协议。

#### 计算机 ping 时发生了什么？

一个计算机 ping 一个 ip 时，首先发送一个 ICMP 协议，但目前只有源 ip 和目的 ip，并不知道对方的 MAC 地址。
所以此时计算机会发送一个 ARP 协议，目的 MAC 地址设为 FFFF.FFFF.FFFF.FFFF。全 F 的 MAC 地址代表广播，即发给所有和该计算机相连接的设备。
报文中会携带源 IP 地址和目的 IP 地址，源 MAC 地址，当收到消息的设备确认目的 IP 是自身时，向源设备返回消息。此时计算机确认 ip 地址的 MAC 地址。
ping 就可以使用 ICMP 协议正常通信了。并且缓存了 ip 地址的 MAC 地址。下一次 ping 时不再重复上述步骤。

一般多台电脑就不太适用了

### 2. 同轴电缆

各种设备连接到同一根电缆上。一台计算机发包时，沿着电缆发送给所有设备，包内会带有目标 MAC 地址，其他设备对比 MAC 地址不是自身时就丢包，不做处理。目的设备就可以精准地接收到包了。

特点

1. 半双工通信。所谓半双工就是同一时间只能沿着一个方向传输。 相对的全双工就是可以双向传输。
2. 容易冲突。 不管是半双工的特点还是发送给所有设备的特点。 一台计算机发送消息时，其他计算机无法发送消息，处理机制是会等待一个随机数，等待过后再检测是否有消息正在传输，以此类推。
3. 不安全。 包发给了所有连接着的设备。虽然正常情况下非目的设备会丢包，但是使用一些抓包工具或者特殊手段，仍然有办法拿到包
4. 电缆任意一处断了，导致整个网络瘫痪。 同轴电缆必须是封闭的，两端都会有电阻。使得电信号到此就结束。 如果有一段中断可能造成信号回传（这一点不太理解，断了和电阻有区别？应该也是电信号结束啊）

### 3. 集线器（Hub）

集线器比之同轴电缆，不再是所有设备连接在一根电缆上，而是所有设备通过电缆和集线器（类似于中心服务器，不过是物理连线的）相连。通信时设备将消息发送给集线器，集线器再将消息发送给其它
连接着的设备。集线器与集线器相连，就能组成更大的网络。

特点：

1. 半双工通信：一台设备在向集线器发送消息的同时是不能接受集线器的消息的。
2. 容易冲突：集线器无法同时接受和发送消息。
3. 不安全
4. 跟同轴电缆基本一样，没啥智商，每次消息都是广播，发给所有连接着的设备，所以说当连接着的设备很多时，效率是非常低的。

优点、进步：

1. 某一根电缆断了不影响其他设备间的通信。

### 4. 网桥

能够通过自学习得知每个接口那侧的 MAC 地址，从而起到隔绝冲突域的作用。
所谓自学习，就是每次有设备发送消息时，会带着源 MAC 地址，网桥就会记录该源 MAC 地址以及在哪一侧。
它的作用是，一旦记录的 MAC 地址比较完整。当同一侧的两台设备通信时，网桥就不会向连接着的其他侧发送包了。从而可以使不同侧同时通信。

### 5. 交换机

相当于接口更多的网桥。也可看成是网桥和集线器的集合。交换机是局域网通信的最终方案。

交换机是直接和设备端相连的，并且在设备发送消息时记录其 MAC 地址。所以一旦 MAC 地址记录较完整时，就会直接在两台设备间通信，而不会将消息发送给其他设备了。

特点：

1. 全双工通信，交换机组织的网络可以同时发送和接收消息。
2. 比集线器安全

思考：
全球所有的设备都用交换机连接会是什么情况？

首先交换机连接的是同一网段的设备，如果全球设备都用交换机，ip 不够用。其次设备首次通信时，只知道 ip 地址不知道 MAC 地址，所以会发送 ARP 广播，全球所有设备广播效率又会很低。即使在同一网段（同一个交换机相连）的两台设备想要通信，也会广播全球设备。 会造成广播风暴（到处充斥着广播）。

### 6. 路由器

网线直连、同轴电缆、集线器、网桥、交换机特点：

1. 连接的设备必须在同一网段
2. 连接的设备处在同一广播域（处在同一个网段就是处在同一个广播域了）。

路由器：

1. 可以在不同网段之间发送数据
2. 隔绝广播域，广播只在路由器的一端进行。

主机发送数据前、首先会判断目标主机的 IP 地址跟它是否在同一个网段

1. 在同一个网段：
   ARP 广播获得目的 MAC 地址 、通过交换机/集线器等等传输
2. 不在同一个网段：
   通过路由器转发数据。具体流程：
   源主机 ARP 广播 => 路由器端的设置的源主机网关地址 => 根据目的 IP 地址到达路由器端设置的目的网关 => 目的主句

   首先源主机发送 ARP 广播，但是这个广播不是为了获得目的 MAC 地址，而是获得该网段的网关 MAC 地址。所有这里有两个前提，首先源主机配置了网关地址，这样当发送不同网段的数据时，数据包中携带的目的 IP 就是网关 ip 地址。 第二就是源主机网段连接路由器的一端配置的 ip 地址即为该网关地址。 这样 ARP 广播就能顺利获取到该段的网关 MAC 地址了。 接下来根据数据包里的目的 ip 地址，路由器在其内部找对应的端口（即目的网关），找到后再从网关发送到目的主机上。流程结束。

   网关地址的最后一位一般配置成 1（非必须，可任意配置）

<!-- ************************************************************************************ -->

# 二、MAC 地址

     每一个网卡都有一个 6 字节（48bit）的 MAC 地址（Media Access Control Address）。

全球唯一，固化在了网卡的 ROM 中，由 IEEE802 标准规定。
前 3 字节：OUI（Organizationally Unique Identifier），组织唯一标识符。由 IEEE 的注册管理结构分配给产商。
后 3 字节：网络接口标识符。由产商自行分配。

如： 40-55-85-0A-8C-6D
一个 16 进制数代表 4 位（二进制），所以 2 个 16 进制就是 1 字节，所以 MAC 地址就是 12 个 16 进制数，6 字节表示。
顺便说一下，十进制下 1 个字节就是 0-255。所以为什么经常看到 255
MAC 地址查询：

1.  产商表： http://standards-oui.ieee.org/oui/oui.txt
2.  MAC 地址信息查询：https://mac.bmcx.com/

## MAC 地址的表示格式

- window：40-55-85-0A-8C-6D

- linux、Android、Mac、IOS：40:55:85:0A:8C:6D
- Packet Tracer: 4055.850A.8C6D
- 当 48 位全为 1 时，即 FF-FF-FF-FF-FF-FF，代表广播地址

  ## MAC 地址的操作

      计算机的 MAC 地址是可以修改的，如下所示，如果不配置默认就是使用网卡中的 MAC 地址。

  1.  更改适配器选项 - 属性 - 配置 -高级 -网络地址
  2.  填写的时候需要把减号（-）去掉。

  有时候可以通过修改 MAC 地址蹭网。一些大型局域网往往限制了接入的 MAC 地址。如果你知道了某一个能够接入的 MAC 地址，就能够通过修改自己的 MAC 地址去蹭网

  ## MAC 地址的获取

  当不知道对方主机的 MAC 地址时，可通过发送 ARP 广播获取对方的 MAC 地址

  1.  获取成功后，会缓存 IP 地址、MAC 地址的映射信息，俗称 ARP 缓存
  2.  通过 ARP 广播获取的 MAC 地址，属于动态（dynamic）缓存。ARP 缓存可通过命令行删除： arp -d [ip]（删除一个）、arp -d (删除所有)。也可通过命令行添加静态缓存： arp -s [ip] [MAC]。
  3.  动态缓存存储时间比较短，一般是 2 分钟。静态存储时间比较长，一般关机前都存在，甚至重启后也存在。不同操作系统对动静态缓存的存储时间有差异。

  # 三、IP 地址

  IP 地址（Internet Protocol Address）：互联网上的每一个主机都有一个 IP 地址

  - 最初是 IPV4 版本，32bit（4 字节），2019 年 11 月 25 日，全球的 IP 地址已经用完
  - 后面推出了 IPv6 版本，128bit（16 字节）

    ## IP 地址的组成

        IP 地址由 2 部分组成：网络标识（网络 ID）、主机标识（主机 ID）

  1.  同一网段的计算机，网络 ID 相同
  2.  通过子网掩码（subnet mask）可以计算出网络 ID：子网掩码 &（按位与） IP 地址。

  比方说 192.168.1.10 的子网掩码位 255.255.255.0，那么前 3 字节就是该 ip 的网络 ID，即处在 192.168.1 网段，最后 1 个字节就是留给该网段的主机 ID，总共可以配置 256-2。不能配置为全 0 或者全 1。主机位全 0 代表网段。主机位全 1 代表广播。
  但是如果子网掩码为 255.255.0.0，那么前 2 字节才是该 ip 的网络 id，即处在 192.168 网段。最后 2 个字节是主机 ID，总共可以配置 256\*256-2 个 ip。

  计算机和其他计算机通信前，会先判断目标主机和自己是否在同一网段。

  ## IP 地址的分类

  1.  A 类地址：默认子网掩码是 255.0.0.0
      8bit 网络 ID，第一位必须以 0 开头，24bit 主机 ID
  2.  B 类地址：默认子网掩码是 255.255.0.0
      16bit 网络 ID，必须以 10 开头，16bit 主机 ID、
  3.  C 类地址： 默认子网掩码是 255.255.255.0
      24bit 网络 ID，必须以 110 开头，8bit 主机 ID
  4.  D 类地址：以 1110 开头，多播地址
  5.  E 类地址：以 1111 开头，保留为今后使用

  注意事项：

  - 只有 A/B/C 类地址才能分配给主机
  - 主机 ID 全为 0，代表主机所在网段
  - 主机 ID 全为 1，表示主机所在网段的全部主机（广播）

### A 类地址

必须以 0 开头
网络 ID：因为第一位固定为 0 了，那么第一个字节还剩下 7 位，范围为 0-127，但是网络 ID 是不允许为全 0 的，所以是 1-127,而 127 是作为保留网段也不可用（熟悉的 127.0.0.1，为本地环回地址(Looback)）。
所以 A 类地址网络 ID 的范围实际为 1-126。只要 ip 地址第一部分为 1-126，就是 A 类地址了。A 类地址能够分配 126 个网段。
主机 ID，第 2、3、4 字节部分的取值范围为 0-255。
每个 A 类网络能容纳的最大主机数：256*256*256 -2 = 2 的 24 次方-2 = 16777214 (-2 是因为全 0 代表网段、全 1 代表广播。)

### B 类地址

必须以 10 开头
范围为 10000000 00000000 ~ 1011 1111。 即 128.0 ~ 191.255。

网络 ID
可以分配给主机的： 第一个字节 128~191、第二个字节 0-255
主机 ID：256\*256-2 = 65534

### C 类地址

必须以 110 开头
范围为 11000000 00000000 00000000 ~ 11011111 11111111 11111111。 即 192.0.0 ~ 223.255.255

网络 ID
第一个字节：192~223
第二、三字节：0~255

主机 ID
第 4 字节取值：0-255
C 类网络能容纳的最大主机数：256-2=254

### D 类地址、E 类地址

D 类地址：没有子网掩码，用于多播（组播）地址。第 1 部分取值：224~239
E 类地址：保留为今后使用，第 1 部分取值范围 240~255

### 子网掩码的 CIDR 表示方法

CIDR（classless Inter-Domain Routing）: 无类别域间路由
例子：
192.168.1.100/24 ,代表子网掩码有 24 个 1，也就是 255.255.255.0
123.210.100.10/24，代表子网掩码有 16 个 1，255.255.0.0

计算工具： https://www.sojson.com/convert/subnetmask.html

## 为什么要进行子网划分？

主要目的是为了合理利用资源。

如果一个局域网部署 200 台主机，那么用 C 类地址，分配一个网段即可，利用率 200/256。 ok
如果一个局域网需要部署 500 台主机，那么 C 类不够用，分配一个 B 类地址网段，利用率 500/65534。就属于比较大的资源浪费了。

### 子网划分

概念：借用主机位作子网位，划分出多个子网。

1. 等长子网划分：将一个网段等分成多个（2 的指数倍）子网，每个子网的可用 IP 地址数量是一样的
2. 变长子网划分：每个子网的可用 IP 地址数量可以是不一样的

#### 等长子网划分

子网划分步骤：

1. 确定子网的子网掩码长度
   以 C 类地址举例 192.168.0.0，其默认子网掩码为 255.255.255.0，那么它可以分配的 IP 为 192.168.0.1 ~ 192.168.0.254
   将它划分子网段，首先就是将子网掩码向右补 1，默认子网掩码最后 1 字节为 0，将该字节的首位设置为 1、即 255.255.255.[10000000]。

   这里要注意，子网掩码设置为 1，ip 与之对应的位就变为了网络 ID，那么主机 ID 此时只剩下 7 位了，同时多了两个网段，因为子网掩码设置为 1 的那位，对应的网络 ID 可以是 0 或者 1，这就是划分出的 2 个子网。

   这两个子网的范围就是 192.168.0.1 ~ 192.168.0.126（127 为主机 ID 全 1，代表广播）、 192.168.0.129（128 主机 ID 全 0，代表网段） ~ 192.168.0.254。 每个子网共有：126 个 ip
   所以可以持续对网段进行子网划分，子网掩码后移 n 位，就划分出了 2 的 n 次方 个子网，子网主机 ID 的长度（位数）就是原网段的 1/2 的 n 次方。

2. 确定子网中第 1 个、最后 1 个主机可用的 IP 地址

思考题：192.168.0.10/24 和 192.168.10.10/16 能正常通信嘛？

不可以， 192.168.10.10/16 的网段为 192.168.0.0/16，而 192.168.0.10/24 的网段为 192.168.0.0/24
192.168.10.10/16 可以和任意 192.168.xxx.xxx 通信。 192.168.0.10/24 可以与任意 192.168.0.xxx 通信
那么 192.168.10.10/16 可以发数据给 192.168.0.10/24，但是反过来则不可以。

老师思路：
1 台主机发送消息时会先判断对方 ip 和自己是否在同一网段，那么怎么得知对方网段呢？ 因为主机发消息前是只知道对方 ip 的，并没有对方的子网掩码。
所以它是拿 目的 ip 和源子网掩码进行按位与。 192.168.0.10/24 拿了目的 ip 192.168.10.10 和自己 24 位子网掩码进行按位与后，得出目的网段为 192.168.10.0，和自己不处于同一网段，会发给网关地址等等，所以此路就不通了，但是反过来可以。和上面自己的思路结论是一样的。

#### 变长子网划分

子网掩码不同，划分出的子网段就是不等长的。因为子网段 A 的子网掩码向右移动了 2 位，那么它的子网长度就是原来的 1/4；
子网段 B 的子网掩码向右移动了 4 位，那么它的子网长度就是原来的 1/16。 这样就是变长子网划分。

### 超网

超网：跟子网反过来，它是将多个连续的网段合并成一个更大的网段。重点连续的，不连续是不可以的。

将子网掩码向左移动，即可实现超网，网络 ID 位数减小，主机 ID 位数增多。可分配的 IP 地址就会增加。
比分说有两个网段 192.168.0.0/24,192.168.1.0/24，可以合并成超网：192.168.0.0/23。

需求：原本有 200 台计算机使用 192.168.0.0/24 网段，现在希望增加 200 台设备到同一个网段。

方法 1：通过分配一个 B 类地址，划分子网就可办到。
方法 2：分配一个 C 类地址，合并网段也可。在这个场景下，超网的方式各合适，因为 C 类地址子网掩码只需要向左移动 1 位，就完成需求。

思考： 192.168.0.255/23 这个 ip 地址，可以分配给计算机使用吗？

可以，主机 ID 部分并不是全 0 或者全 1。因为子网掩码向左移动了 1 位，所以此时的全 1 应该是 192.168.1.255 。

思考：192.168.1.0/24 和 192.168.2.0/24 两个网段可以通过子网掩码向左移动 1 位进行合并吗？
不可以。192.168.1.0/24 子网掩码向左移动 1 位只能合并 192.168.1.0/24 和 192.168.0.0/24，

合并网段规律：
如果想通过左移 1 位实现合并，需满足：

1. 必须是连续的，因为左移 1 位只能合并 2 个 ip。
2. 第一个网段必须能被 2 整除（10 进制表示时），若由二进制表示，则最后一位是 0.

它的本质就是转成二进制表示后，左移一位，网络 ID 部分相同，则代表可合并。

如果想通过左移 2 位实现合并，需满足：

1. 连续，
2. 第一个网段能够被 4 整除。二进制表示就需以 00 结尾。以此类推

### 判断一个网段是子网还是超网

1. 判断该 ip 的类型，A/B/C
2. 获知该类型的默认子网掩码，A（8），B（16），C（24）
3. 如果该网段的子网掩码位数比默认子网掩码多，就是子网;如果该网段的子网掩码位数比默认子网掩码少，则是超网。

   25.100.0.0/16 是一个 A 类子网
   200.100.0.0/16 是一个 C 类超网

# 路由

在不同网段之间转发数据，需要有路由器的支持
默认情况下，路由器只知道跟它直连的网段非直连的网段需要通过静态路由、动态路由告诉它。
举例：A 路由器跟 B 路由器相连，A 无法知道 B 路由器连接着的设备网段，只能知道 A 自身连接着的设备网段。

1. 静态路由：
   管理员手动添加路由信息，适用于小规模网络
2. 动态路由：
   路由器通过路由选择协议（比如 RIP、OSPF）自动获取路由信息，适用于大规模网络。

练习题：
让 4 台主机之间互相通信（4 个不同网段，使用两台路由器，使用静态路由）
192.168.1.10/24
192.168.2.10/24
193.169.1.10/24
193.169.2.10/24

实验步骤：

1. 配置好 4 台 pc、4 台交换机、两个路由器，并且连接起来，这里有一个疑问，为什么 pc 不能直接跟路由器相连，一定要通过交换机中转？
2. 配置 PC 的网关地址，和连接路由器端口的地址一致，此时路由器直连的端口，这些网段之间已经能够通信。
3. 配置路由器和路由器直连的两个端口。交换机连接着路由器的端口类型是 fastEthernet，而路由器和路由器连接的端口类型为 serial 端口。
   配置 serial 端口的 ip 和掩码，要求是和直连路由器的端口不在同一网段。 两个路由器相连的 serial 端口 ip 必须在同一网段，因为他们两个之间是网线直连，不在同一网段无法通信。
4. 配置路由器的静态路由。 添加 1 个静态路由，网络和掩码填写目的 IP 的网段和掩码，下一跳填写与之相连的路由器端口 ip。这个配置什么意思呢？
   就是路由器接收到消息，在路由表中找到该地址属于某个静态路由的网段，就将包发送给该静态路由下一跳的地址。

注意：

1. 路由器的端口默认是关的，要打开后才会通
2. 点击左上角的放大镜（检查）可以查看路由器的路由表，类型 C（connect）代表直连端口路由，类型 S（static）代表静态路由。
3. 本质是通过命令行界面添加，所以可以通过命令行添加静态路由，太专业，后续有需要再学习。
4. 可通过将静态路由的网络和掩码配置的大一点，也就是网络掩码全 1 个数较少。如 255.0.0.0，那网段就只会是第一部分，比如 192.0.0.0，所有 192 开头的目标地址都走该路由了。 再继续延伸，将网络和掩码都配置为 0.0.0.0，就是默认路由，即如果静态路由表中没找到就去这个地址。 当然，越精确的地址匹配优先级越高。
