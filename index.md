# 一、基本概念

## 1. 总体概述

### C\C++ 的跨平台原理

.c/cpp 文件会被编译成不同的文件（可执行文件），以便在不同平台上运行。 比如 window 编译成 PE 格式文件。 Mac => Mach-o 、 Linux => ELF。

### java 的跨平台原理

.java =>编译后 => .class(字节码) => 运行在平台上的 JVM（JAVA 虚拟机） => 再编译成机器指令 => 在操作系统运行

### js 的跨平台原理

js => 浏览器（各平台浏览器） => 编译成机器指令 => 操作系统运行

### 网络模型

OSI 模型：国际标准化组织 ISO 在 1985 年制定，偏理论，有点偏离实际。
TCP/IP 协议：实际开发人员认可的协议模型。
学习研究：将 TCP/IP 层的网络接口层，分为和 OSI 模型一样，分为数据链路层和物理层。主要是为了做研究。

<!-- ************************************************************************************ -->

### A 类地址

必须以 0 开头
网络 ID：因为第一位固定为 0 了，那么第一个字节还剩下 7 位，范围为 0-127，但是网络 ID 是不允许为全 0 的，所以是 1-127,而 127 是作为保留网段也不可用（熟悉的 127.0.0.1，为本地环回地址(Looback)）。
所以 A 类地址网络 ID 的范围实际为 1-126。只要 ip 地址第一部分为 1-126，就是 A 类地址了。A 类地址能够分配 126 个网段。
主机 ID，第 2、3、4 字节部分的取值范围为 0-255。
每个 A 类网络能容纳的最大主机数：256*256*256 -2 = 2 的 24 次方-2 = 16777214 (-2 是因为全 0 代表网段、全 1 代表广播。)

### B 类地址

必须以 10 开头
范围为 10000000 00000000 ~ 1011 1111。 即 128.0 ~ 191.255。

网络 ID
可以分配给主机的： 第一个字节 128~191、第二个字节 0-255
主机 ID：256\*256-2 = 65534

### C 类地址

必须以 110 开头
范围为 11000000 00000000 00000000 ~ 11011111 11111111 11111111。 即 192.0.0 ~ 223.255.255

网络 ID
第一个字节：192~223
第二、三字节：0~255

主机 ID
第 4 字节取值：0-255
C 类网络能容纳的最大主机数：256-2=254

### D 类地址、E 类地址

D 类地址：没有子网掩码，用于多播（组播）地址。第 1 部分取值：224~239
E 类地址：保留为今后使用，第 1 部分取值范围 240~255

### 子网掩码的 CIDR 表示方法

CIDR（classless Inter-Domain Routing）: 无类别域间路由
例子：
192.168.1.100/24 ,代表子网掩码有 24 个 1，也就是 255.255.255.0
123.210.100.10/24，代表子网掩码有 16 个 1，255.255.0.0

计算工具： https://www.sojson.com/convert/subnetmask.html

## 为什么要进行子网划分？

主要目的是为了合理利用资源。

如果一个局域网部署 200 台主机，那么用 C 类地址，分配一个网段即可，利用率 200/256。 ok
如果一个局域网需要部署 500 台主机，那么 C 类不够用，分配一个 B 类地址网段，利用率 500/65534。就属于比较大的资源浪费了。

### 子网划分

概念：借用主机位作子网位，划分出多个子网。

1. 等长子网划分：将一个网段等分成多个（2 的指数倍）子网，每个子网的可用 IP 地址数量是一样的
2. 变长子网划分：每个子网的可用 IP 地址数量可以是不一样的

#### 等长子网划分

子网划分步骤：

1. 确定子网的子网掩码长度
   以 C 类地址举例 192.168.0.0，其默认子网掩码为 255.255.255.0，那么它可以分配的 IP 为 192.168.0.1 ~ 192.168.0.254
   将它划分子网段，首先就是将子网掩码向右补 1，默认子网掩码最后 1 字节为 0，将该字节的首位设置为 1、即 255.255.255.[10000000]。

    这里要注意，子网掩码设置为 1，ip 与之对应的位就变为了网络 ID，那么主机 ID 此时只剩下 7 位了，同时多了两个网段，因为子网掩码设置为 1 的那位，对应的网络 ID 可以是 0 或者 1，这就是划分出的 2 个子网。

    这两个子网的范围就是 192.168.0.1 ~ 192.168.0.126（127 为主机 ID 全 1，代表广播）、 192.168.0.129（128 主机 ID 全 0，代表网段） ~ 192.168.0.254。 每个子网共有：126 个 ip
    所以可以持续对网段进行子网划分，子网掩码后移 n 位，就划分出了 2 的 n 次方 个子网，子网主机 ID 的长度（位数）就是原网段的 1/2 的 n 次方。

2. 确定子网中第 1 个、最后 1 个主机可用的 IP 地址

思考题：192.168.0.10/24 和 192.168.10.10/16 能正常通信嘛？

不可以， 192.168.10.10/16 的网段为 192.168.0.0/16，而 192.168.0.10/24 的网段为 192.168.0.0/24
192.168.10.10/16 可以和任意 192.168.xxx.xxx 通信。 192.168.0.10/24 可以与任意 192.168.0.xxx 通信
那么 192.168.10.10/16 可以发数据给 192.168.0.10/24，但是反过来则不可以。

老师思路：
1 台主机发送消息时会先判断对方 ip 和自己是否在同一网段，那么怎么得知对方网段呢？ 因为主机发消息前是只知道对方 ip 的，并没有对方的子网掩码。
所以它是拿 目的 ip 和源子网掩码进行按位与。 192.168.0.10/24 拿了目的 ip 192.168.10.10 和自己 24 位子网掩码进行按位与后，得出目的网段为 192.168.10.0，和自己不处于同一网段，会发给网关地址等等，所以此路就不通了，但是反过来可以。和上面自己的思路结论是一样的。

#### 变长子网划分

子网掩码不同，划分出的子网段就是不等长的。因为子网段 A 的子网掩码向右移动了 2 位，那么它的子网长度就是原来的 1/4；
子网段 B 的子网掩码向右移动了 4 位，那么它的子网长度就是原来的 1/16。 这样就是变长子网划分。

### 超网

超网：跟子网反过来，它是将多个连续的网段合并成一个更大的网段。重点连续的，不连续是不可以的。

将子网掩码向左移动，即可实现超网，网络 ID 位数减小，主机 ID 位数增多。可分配的 IP 地址就会增加。
比分说有两个网段 192.168.0.0/24,192.168.1.0/24，可以合并成超网：192.168.0.0/23。

需求：原本有 200 台计算机使用 192.168.0.0/24 网段，现在希望增加 200 台设备到同一个网段。

方法 1：通过分配一个 B 类地址，划分子网就可办到。
方法 2：分配一个 C 类地址，合并网段也可。在这个场景下，超网的方式各合适，因为 C 类地址子网掩码只需要向左移动 1 位，就完成需求。

思考： 192.168.0.255/23 这个 ip 地址，可以分配给计算机使用吗？

可以，主机 ID 部分并不是全 0 或者全 1。因为子网掩码向左移动了 1 位，所以此时的全 1 应该是 192.168.1.255 。

思考：192.168.1.0/24 和 192.168.2.0/24 两个网段可以通过子网掩码向左移动 1 位进行合并吗？
不可以。192.168.1.0/24 子网掩码向左移动 1 位只能合并 192.168.1.0/24 和 192.168.0.0/24，

合并网段规律：
如果想通过左移 1 位实现合并，需满足：

1. 必须是连续的，因为左移 1 位只能合并 2 个 ip。
2. 第一个网段必须能被 2 整除（10 进制表示时），若由二进制表示，则最后一位是 0.

它的本质就是转成二进制表示后，左移一位，网络 ID 部分相同，则代表可合并。

如果想通过左移 2 位实现合并，需满足：

1. 连续，
2. 第一个网段能够被 4 整除。二进制表示就需以 00 结尾。以此类推

### 判断一个网段是子网还是超网

1. 判断该 ip 的类型，A/B/C
2. 获知该类型的默认子网掩码，A（8），B（16），C（24）
3. 如果该网段的子网掩码位数比默认子网掩码多，就是子网;如果该网段的子网掩码位数比默认子网掩码少，则是超网。

    25.100.0.0/16 是一个 A 类子网
    200.100.0.0/16 是一个 C 类超网

# 路由

在不同网段之间转发数据，需要有路由器的支持
默认情况下，路由器只知道跟它直连的网段非直连的网段需要通过静态路由、动态路由告诉它。
举例：A 路由器跟 B 路由器相连，A 无法知道 B 路由器连接着的设备网段，只能知道 A 自身连接着的设备网段。

1. 静态路由：
   管理员手动添加路由信息，适用于小规模网络
2. 动态路由：
   路由器通过路由选择协议（比如 RIP、OSPF）自动获取路由信息，适用于大规模网络。

练习题：
让 4 台主机之间互相通信（4 个不同网段，使用两台路由器，使用静态路由）
192.168.1.10/24
192.168.2.10/24
193.169.1.10/24
193.169.1.10/24

